/* Using this dataset, show the SQL query that provides January 31's rolling 3 day average of total transaction amount processed per day */

WITH daily_totals AS (
  SELECT
    DATE(transaction_time) AS day,
    SUM(transaction_amount) AS total_amount
  FROM transactions
  GROUP BY DATE(transaction_time)
),
rolling_avg AS (
  SELECT
    day,
    AVG(total_amount) OVER (
      ORDER BY day
      ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ) AS rolling_3day_avg
  FROM daily_totals
)
SELECT
  day,
  rolling_3day_avg
FROM rolling_avg
WHERE day = '2021-01-31';

-- Result: rolling_3day_avg for 2021-01-31 = 682.15